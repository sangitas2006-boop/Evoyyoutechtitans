<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EVOYOU - Schedule Your Day</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* BASE STYLES & FONT FIX: Ensure Inter is the global font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: transparent; 
            min-height: 100vh;
            position: relative; 
            z-index: 1; 
            font-size: 1rem; 
        }

        /* STICKER BACKGROUND LAYER (Unchanged opacity) */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(245, 245, 220, 0.7); 
            background-image: url('bg1.png'); 
            background-repeat: repeat;
            background-size: 150px 150px; 
            opacity: 1.5; 
            z-index: -1;
        }
        /* END STICKER CODE */

        /* --- MOBILE/DESKTOP VIEW SEPARATION --- */
        /* Custom Mobile Navbar Height (for pt-16 main padding) */
        .navbar-mobile-height {
            height: 64px; /* h-16 equivalent */
        }
        
        /* SCROLL ANIMATION */
        .scroll-animate {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .scroll-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* FLOATING ACTION BUTTON (FAB) */
        #ai-fab {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 56px;
            height: 56px;
            border-radius: 9999px;
            background: #ffffff;
            color: #b91c1c;
            border: 2px solid rgba(0,0,0,0.06);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 999;
            transition: transform 0.12s ease;
        }
        #ai-fab:hover { transform: translateY(-4px); }

        /* NAVBAR LOGO FIX */
        .navbar-logo {
            height: 2.5rem; 
            width: auto;
            filter: brightness(1.3) contrast(1.1);
        }

        /* MODAL UTILITIES & OTHER STYLES (Unchanged) */
        .hidden { display: none; }
        .fixed { position: fixed; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        #ai-response-area { white-space: pre-wrap; }
        .schedule-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #dbeafe;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
            border-left: 4px solid #3b82f6;
        }
        @media (max-width: 640px) {
            .schedule-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.75rem;
            }
            .schedule-item > .flex-grow {
                width: 100%;
                margin-top: 0.5rem;
            }
            .schedule-item > button {
                position: absolute;
                top: 0.5rem;
                right: 0.5rem;
            }
        }
        .schedule-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .time-slot {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            min-width: 110px; 
            max-width: 120px;
            text-align: center;
            flex-shrink: 0; 
        }
        #settings-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            min-width: 180px;
            z-index: 60;
        }
        .activity-type-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .activity-work { background-color: #fef3c7; color: #92400e; }
        .activity-exercise { background-color: #dcfce7; color: #166534; }
        .activity-personal { background-color: #e0e7ff; color: #3730a3; }
        .activity-other { background-color: #f3e8ff; color: #6b21a8; }
    </style>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<body class="text-black"> 

    <header id="navbar-container" class="fixed top-0 left-0 right-0 z-50 bg-gray-900 shadow-lg transition duration-300">
        
        <div id="navbar-mobile" class="md:hidden">
            <div class="flex justify-between items-center navbar-mobile-height  w-auto">
                
                <a href="index.html" title="EVOYOU - Home" class="flex items-center space-x-0"> 
                    <img src="logo.png" alt="EVOYOU Logo" class="h-10 w-auto" style="filter: brightness(1.3) contrast(1.1);">
                </a>

                <div class="flex items-center space-x-2">
                    <button id="ai-open-btn-mobile" title="AI Assistant" class="p-2 rounded-full hover:bg-red-500 hover:text-white transition duration-150 cursor-pointer text-red-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M19 12h1m-1.636 6.364l-.707-.707M4 12H3m1.636 6.364l.707-.707M6.012 10.362a1 1 0 00.373-.801l-.774-3.138A6.364 6.364 0 0112 4.16V3a.5.5 0 01.5-.5h1a.5.5 0 01.5.5v1.16a6.364 6.364 0 015.429 5.429l-3.138.774a1 1 0 00-.8.373 6.364 6.364 0 01-4.8 11.235 6.364 6.364 0 01-1.294-.135" />
                        </svg>
                    </button>

                    <button id="mobile-menu-open-btn" title="Menu" class="p-2 rounded-full hover:bg-gray-700 transition duration-150 cursor-pointer text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="navbar-desktop" class="hidden md:block">
            <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-">
                <div class="flex justify-between items-center h-16 sm:h-20 md:h-28"> 
                    <div class="flex-shrink-0">
                        <a href="index.html" title="EVOYOU - Home" class="flex items-center  "> 
                            <img src="logo.png" alt="EVOYOU Logo" class="w-60 h-55 px-6 mx-8" style="filter: brightness(1.3) contrast(1.1);">
                        </a>
                    </div>
                    
                    <nav class="hidden md:flex space-x-8">
                        <a href="index.html#dashboard-section" class="text-lg font-bold text-gray-200 hover:text-red-400 transition duration-150 mt-1">Dashboard</a>
                        <a href="index.html" class="text-lg font-bold text-gray-200 hover:text-red-400 transition duration-150 mt-1 ">Home</a>
                    </nav>

                    <div class="flex items-center space-x-3 relative"> 
                        <button id="auth-open-btn-desktop" title="Log In" class="p-2 rounded-full hover:bg-gray-700 transition duration-150 cursor-pointer text-blue-400 text-sm">Log In</button>
                        
                        <div class="relative inline-block text-left">
                            <button id="settings-open-btn" title="Settings" class="p-2 rounded-full hover:bg-gray-700 transition duration-150 cursor-pointer text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </button>
                            <div id="settings-dropdown" class="origin-top-right absolute right-0 mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden">
                                <div class="py-1" role="menu" aria-orientation="vertical">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-red-500 transition duration-100" role="menuitem">Profile</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-red-500 transition duration-100" role="menuitem">Account</a>
                                    <a href="#" id="notifications-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-red-500 transition duration-100" role="menuitem">Notifications</a>
                                    <a href="#" id="settings-logout-btn" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition duration-100" role="menuitem">Log Out (Demo)</a>
                                </div>
                            </div>
                        </div>

                        <button id="ai-open-btn-desktop" title="AI Assistant" class="p-2 rounded-full hover:bg-red-500 hover:text-white transition duration-150 cursor-pointer text-red-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M19 12h1m-1.636 6.364l-.707-.707M4 12H3m1.636 6.364l.707-.707M6.012 10.362a1 1 0 00.373-.801l-.774-3.138A6.364 6.364 0 0112 4.16V3a.5.5 0 01.5-.5h1a.5.5 0 01.5.5v1.16a6.364 6.364 0 015.429 5.429l-3.138.774a1 1 0 00-.8.373 6.364 6.364 0 01-4.8 11.235 6.364 6.364 0 01-1.294-.135" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div id="mobile-menu-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 z-[150] flex items-start justify-end p-0">
        <div class="bg-white h-full w-64 p-6 shadow-2xl relative">
            <div class="flex justify-end mb-6">
                <button id="mobile-menu-close-btn" class="text-gray-600 hover:text-gray-800 text-2xl font-semibold" aria-label="Close">&times;</button>
            </div>
            <nav class="flex flex-col space-y-4">
                <a href="index.html#dashboard-section" class="mobile-menu-link text-xl font-bold text-gray-800 hover:text-red-600 transition duration-150">Dashboard</a>
                <a href="index.html" class="mobile-menu-link text-xl font-bold text-gray-800 hover:text-red-600 transition duration-150">Home</a>
            </nav>
            <div class="border-t mt-6 pt-6 space-y-3">
                 <button id="auth-open-btn-mobile-menu" class="w-full py-2 text-center rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600">Log In</button>
                 <a href="#" class="block text-center text-sm text-gray-600 hover:text-red-600">Settings</a>
            </div>
        </div>
    </div>


    <main id="app-main" class="pt-16 md:pt-24"> 
        <section class="py-12 sm:py-16"> 
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-gray-800 mb-4">
                        📅 SCHEDULE YOUR DAY
                    </h1>
                    <p class="text-base sm:text-lg text-gray-600 max-w-2xl mx-auto">
                        Create your perfect daily schedule and maximize productivity with AI assistance
                    </p>
                </div>

                <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl p-6 sm:p-8 mb-12 scroll-animate">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 border-b pb-4">
                        ➕ Add New Activity
                    </h2>
                    <form id="schedule-form" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label for="activity-name" class="block text-sm font-semibold text-gray-700 mb-2">Activity Name</label>
                                <input 
                                    type="text" 
                                    id="activity-name" 
                                    placeholder="e.g., Morning Workout" 
                                    required 
                                    class="w-full p-3 border border-gray-300 rounded-lg text-base focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                            <div>
                                <label for="activity-type" class="block text-sm font-semibold text-gray-700 mb-2">Activity Type</label>
                                <select 
                                    id="activity-type" 
                                    class="w-full p-3 border border-gray-300 rounded-lg text-base focus:ring-blue-500 focus:border-blue-500"
                                >
                                    <option value="work">Work</option>
                                    <option value="exercise">Exercise</option>
                                    <option value="personal">Personal</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label for="start-time" class="block text-sm font-semibold text-gray-700 mb-2">Start Time</label>
                                <input 
                                    type="time" 
                                    id="start-time" 
                                    required 
                                    class="w-full p-3 border border-gray-300 rounded-lg text-base focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                            <div>
                                <label for="end-time" class="block text-sm font-semibold text-gray-700 mb-2">End Time</label>
                                <input 
                                    type="time" 
                                    id="end-time" 
                                    required 
                                    class="w-full p-3 border border-gray-300 rounded-lg text-base focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                        </div>

                        <div>
                            <label for="activity-notes" class="block text-sm font-semibold text-gray-700 mb-2">Notes (Optional)</label>
                            <textarea 
                                id="activity-notes" 
                                placeholder="Add any additional details..." 
                                rows="2"
                                class="w-full p-3 border border-gray-300 rounded-lg text-base focus:ring-blue-500 focus:border-blue-500"
                            ></textarea>
                        </div>

                        <button 
                            type="submit" 
                            class="w-full py-3 sm:py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-base font-bold rounded-lg shadow-lg hover:from-blue-700 hover:to-purple-700 transition duration-200 transform hover:scale-[1.02]"
                        >
                            Add to Schedule
                        </button>
                    </form>
                </div>

                <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl p-6 sm:p-8 scroll-animate">
                    <div class="flex justify-between items-center mb-6 border-b pb-4">
                        <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">
                            📋 Today's Schedule
                        </h2>
                        <button 
                            id="clear-schedule-btn" 
                            class="px-3 sm:px-4 py-1 sm:py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition duration-150 text-sm font-semibold"
                        >
                            Clear All
                        </button>
                    </div>
                    
                    <div id="schedule-list" class="space-y-4 min-h-[200px]">
                        </div>
                </div>

                <div class="max-w-4xl mx-auto mt-8 bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-6 scroll-animate">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">💡 Quick AI Tips</h3>
                    <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-4">
                        <button 
                            class="ai-suggestion-btn p-4 bg-white rounded-lg shadow hover:shadow-lg transition duration-200 text-left"
                            data-prompt="Create a schedule for a busy professional"
                        >
                            <span class="text-2xl">💼</span>
                            <p class="font-semibold text-gray-800 mt-2">Busy Professional</p>
                            <p class="text-sm text-gray-600">Balanced work-life schedule</p>
                        </button>
                        <button 
                            class="ai-suggestion-btn p-4 bg-white rounded-lg shadow hover:shadow-lg transition duration-200 text-left"
                            data-prompt="Create a schedule for a student with classes"
                        >
                            <span class="text-2xl">📚</span>
                            <p class="font-semibold text-gray-800 mt-2">Student Schedule</p>
                            <p class="text-sm text-gray-600">Study blocks & breaks</p>
                        </button>
                        <button 
                            class="ai-suggestion-btn p-4 bg-white rounded-lg shadow hover:shadow-lg transition duration-200 text-left"
                            data-prompt="Create a fitness-focused daily schedule"
                        >
                            <span class="text-2xl">🏃</span>
                            <p class="font-semibold text-gray-800 mt-2">Fitness Focus</p>
                            <p class="text-sm text-gray-600">Exercise & wellness</p>
                        </button>
                        <button 
                            class="ai-suggestion-btn p-4 bg-white rounded-lg shadow hover:shadow-lg transition duration-200 text-left"
                            data-prompt="Create a creative work schedule with deep work blocks"
                        >
                            <span class="text-2xl">🎨</span>
                            <p class="font-semibold text-gray-800 mt-2">Creative Work</p>
                            <p class="text-sm text-gray-600">Deep work sessions</p>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-lg font-semibold mb-2"><u>EVOYOU</u></p>
            <p class="text-sm text-gray-400">© 2025 All Rights Reserved.</p>
            <a href="index.html" class="text-blue-400 hover:text-blue-300 text-sm mt-2 inline-block">← Back to Home</a>
        </div>
    </footer>

    <div id="auth-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-8 w-full max-w-md shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h4 id="auth-modal-title" class="text-2xl font-bold text-gray-800">Log In</h4>
                <button id="auth-close-btn" class="text-gray-400 hover:text-gray-600 text-2xl font-semibold" aria-label="Close">&times;</button>
            </div>
            <div id="auth-message-box" class="hidden p-3 mb-4 rounded-lg text-sm"></div>
            <form id="auth-form" class="space-y-4">
                <input type="email" id="auth-email" placeholder="Email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
                <input type="password" id="auth-password" placeholder="Password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
                <button type="submit" id="auth-submit-btn" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-150">
                    Log In
                </button>
            </form>
            <p class="mt-6 text-center text-sm text-gray-600">
                <span id="auth-toggle-text">Need an account?</span>
                <button id="auth-toggle-btn" class="text-blue-600 font-medium hover:text-blue-700 ml-1">Sign Up</button>
            </p>
        </div>
    </div>

    <button id="ai-fab" title="Ask Evo-AI" aria-label="Ask Evo-AI" class="hidden md:flex">💬</button> 

    <div id="ai-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 z-[200] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg shadow-2xl relative">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Evo-AI — Scheduling Assistant</h3>
                <button id="ai-close" class="text-gray-400 hover:text-gray-600 text-2xl font-semibold" aria-label="Close">&times;</button>
            </div>

            <div id="ai-response-area" class="h-64 overflow-y-auto p-3 mb-4 border rounded-lg bg-gray-50 text-gray-700 text-sm">
                Hello! I'm Evo-AI, your scheduling assistant. Ask me to help you create the perfect schedule, or give you productivity tips! 
                
Examples:
• "Create a schedule for a busy professional"
• "How should I structure my study time?"
• "Give me a morning routine for better focus"
            </div>

            <form id="ai-form" class="space-y-3">
                <textarea id="ai-input" placeholder="Ask Evo-AI for scheduling help..." rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 resize-none"></textarea>
                <button type="submit" id="ai-submit-btn" class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-150">
                    Ask AI
                </button>
            </form>
        </div>
    </div>

    <script type="module">
        // Utility function to select elements
        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => document.querySelectorAll(sel);

        // Helper function for HTML escaping
        function escapeHtml(unsafe) {
            return unsafe
                .replaceAll("&", "&amp;")
                .replaceAll("<", "&lt;")
                .replaceAll(">", "&gt;")
                .replaceAll('"', "&quot;")
                .replaceAll("'", "&#039;");
        }

        // --- GLOBAL SETUP & ANIMATION ---
        const animateElements = document.querySelectorAll('.scroll-animate');
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('visible');
            });
        }, { threshold: 0.1 });
        animateElements.forEach(el => observer.observe(el));

        // --- AUTH & SETTINGS MODAL LOGIC ---

        const authModal = $('#auth-modal');
        const authCloseBtn = $('#auth-close-btn');
        const authForm = $('#auth-form');
        const authToggleBtn = $('#auth-toggle-btn');
        const authModalTitle = $('#auth-modal-title');
        const authMessageBox = $('#auth-message-box');
        let isSigningUp = false;

        function toggleAuthModal(show) {
            if (!authModal) return;
            authModal.classList.toggle('hidden', !show);
        }

        // Desktop Log In button
        if ($('#auth-open-btn-desktop')) $('#auth-open-btn-desktop').addEventListener('click', () => toggleAuthModal(true));
        // Mobile Log In button in menu
        if ($('#auth-open-btn-mobile-menu')) $('#auth-open-btn-mobile-menu').addEventListener('click', () => {
            toggleAuthModal(true);
            toggleMobileMenu(false); // Close mobile menu when opening auth modal
        });
        
        if (authCloseBtn) authCloseBtn.addEventListener('click', () => toggleAuthModal(false));

        if (authToggleBtn) {
            authToggleBtn.addEventListener('click', () => {
                isSigningUp = !isSigningUp;
                authModalTitle.textContent = isSigningUp ? 'Sign Up' : 'Log In';
                $('#auth-submit-btn').textContent = isSigningUp ? 'Sign Up' : 'Log In';
                $('#auth-toggle-text').textContent = isSigningUp ? 'Already have an account?' : 'Need an account?';
                authToggleBtn.textContent = isSigningUp ? 'Log In' : 'Sign Up';
                authMessageBox.classList.add('hidden');
            });
        }

        if (authForm) {
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = $('#auth-email').value;
                
                if (!email || email.indexOf('@') === -1) {
                    authMessageBox.textContent = 'Please enter a valid email.';
                    authMessageBox.className = 'p-3 mb-4 rounded-lg text-sm bg-red-100 text-red-700';
                    authMessageBox.classList.remove('hidden');
                    return;
                }
                
                authMessageBox.textContent = isSigningUp ? 'Sign Up successful! (demo)' : 'Log In successful! (demo)';
                authMessageBox.className = 'p-3 mb-4 rounded-lg text-sm bg-green-100 text-green-700';
                authMessageBox.classList.remove('hidden');
                setTimeout(() => toggleAuthModal(false), 900);
            });
        }

        // Settings Dropdown (Desktop)
        const settingsOpenBtn = $('#settings-open-btn');
        const settingsDropdown = $('#settings-dropdown');

        if (settingsOpenBtn) {
            settingsOpenBtn.addEventListener('click', () => {
                if (settingsDropdown) settingsDropdown.classList.toggle('hidden');
            });
        }

        document.addEventListener('click', (event) => {
            if (settingsDropdown && !settingsDropdown.contains(event.target) && 
                settingsOpenBtn && !settingsOpenBtn.contains(event.target) && 
                !settingsDropdown.classList.contains('hidden')) {
                settingsDropdown.classList.add('hidden');
            }
        }); 
        
        // --- MOBILE MENU LOGIC ---
        const mobileMenuModal = $('#mobile-menu-modal');
        const mobileMenuOpenBtn = $('#mobile-menu-open-btn');
        const mobileMenuCloseBtn = $('#mobile-menu-close-btn');

        function toggleMobileMenu(show) {
            if (!mobileMenuModal) return;
            mobileMenuModal.classList.toggle('hidden', !show);
        }

        if (mobileMenuOpenBtn) mobileMenuOpenBtn.addEventListener('click', () => toggleMobileMenu(true));
        if (mobileMenuCloseBtn) mobileMenuCloseBtn.addEventListener('click', () => toggleMobileMenu(false));
        
        // **FIX**: Close mobile menu when a navigation link is clicked
        $$('.mobile-menu-link').forEach(link => {
            link.addEventListener('click', () => {
                toggleMobileMenu(false);
            });
        });

        // --- SCHEDULE MANAGEMENT LOGIC ---

        let scheduleItems = [];
        let nextScheduleId = 1;
        const scheduleForm = $('#schedule-form');
        const scheduleList = $('#schedule-list');
        const clearScheduleBtn = $('#clear-schedule-btn');

        function renderSchedule() {
            if (!scheduleList) return;

            scheduleList.innerHTML = '';

            if (scheduleItems.length === 0) {
                scheduleList.innerHTML = '<div class="text-center p-8 text-gray-500"><p class="text-xl">No activities scheduled yet.</p><p class="text-sm mt-2">Add your first activity above or ask AI for suggestions!</p></div>';
                return;
            }

            // Sort by start time
            scheduleItems.sort((a, b) => a.startTime.localeCompare(b.startTime));

            scheduleItems.forEach(item => {
                const scheduleDiv = document.createElement('div');
                scheduleDiv.className = 'schedule-item relative'; 
                scheduleDiv.dataset.id = item.id;

                scheduleDiv.innerHTML = `
                    <div class="flex items-center space-x-4 flex-grow w-full"> 
                        <div class="time-slot">
                            ${item.startTime} - ${item.endTime}
                        </div>
                        <div class="flex-grow min-w-0"> 
                            <div class="flex items-center gap-2 mb-1 flex-wrap"> 
                                <h4 class="text-lg font-bold text-gray-800">${escapeHtml(item.name)}</h4>
                                <span class="activity-type-badge activity-${item.type}">${item.type}</span>
                            </div>
                            ${item.notes ? `<p class="text-sm text-gray-600">${escapeHtml(item.notes)}</p>` : ''}
                        </div>
                    </div>
                    <button class="delete-schedule-btn text-gray-400 hover:text-red-600 transition duration-150 p-2 rounded-full flex-shrink-0" title="Delete Activity">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;

                scheduleList.appendChild(scheduleDiv);
            });

            // Attach delete handlers
            scheduleList.querySelectorAll('.delete-schedule-btn').forEach(btn => {
                btn.onclick = handleDeleteSchedule;
            });
        }

        function handleDeleteSchedule(e) {
            const itemElement = e.target.closest('.schedule-item');
            if (!itemElement) return; 

            const scheduleId = parseInt(itemElement.dataset.id);
            if (confirm('Remove this activity from your schedule?')) {
                scheduleItems = scheduleItems.filter(item => item.id !== scheduleId);
                renderSchedule();
            }
        }

        if (scheduleForm) {
            scheduleForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const name = $('#activity-name').value.trim();
                const type = $('#activity-type').value;
                const startTime = $('#start-time').value;
                const endTime = $('#end-time').value;
                const notes = $('#activity-notes').value.trim();

                if (!name || !startTime || !endTime) return;

                scheduleItems.push({
                    id: nextScheduleId++,
                    name,
                    type,
                    startTime,
                    endTime,
                    notes
                });

                scheduleForm.reset();
                renderSchedule();
            });
        }

        if (clearScheduleBtn) {
            clearScheduleBtn.addEventListener('click', () => {
                if (confirm('Clear all scheduled activities?')) {
                    scheduleItems = [];
                    renderSchedule();
                }
            });
        }

        // --- AI MODAL LOGIC ---

        const aiFab = $('#ai-fab');
        const aiOpenBtnDesktop = $('#ai-open-btn-desktop'); // Desktop navbar AI button
        const aiOpenBtnMobile = $('#ai-open-btn-mobile'); // Mobile navbar AI button
        const aiModal = $('#ai-modal');
        const aiClose = $('#ai-close');
        const aiForm = $('#ai-form');
        const aiInput = $('#ai-input');
        const aiResponseArea = $('#ai-response-area');

        const aiScheduleReplies = {
            'professional': `📅 BUSY PROFESSIONAL SCHEDULE: 
 • 6:00 AM - 6:30 AM: Morning routine & meditation
 • 6:30 AM - 7:00 AM: Exercise/workout
 • 7:00 AM - 8:00 AM: Breakfast & planning
 • 8:00 AM - 12:00 PM: Deep work (most important tasks)
 • 12:00 PM - 1:00 PM: Lunch break
 • 1:00 PM - 3:00 PM: Meetings & collaboration
 • 3:00 PM - 3:15 PM: Short break
 • 3:15 PM - 5:00 PM: Project work
 • 5:00 PM - 6:00 PM: Email & admin tasks
 • 6:00 PM onwards: Personal time & family
 
 Pro tip: Block calendar for deep work!`,
            'student': `📚 STUDENT SCHEDULE: 
 • 7:00 AM - 8:00 AM: Morning routine
 • 8:00 AM - 12:00 PM: Classes/lectures
 • 12:00 PM - 1:00 PM: Lunch break
 • 1:00 PM - 3:00 PM: Study session 1 (hardest subjects)
 • 3:00 PM - 3:30 PM: Break & exercise
 • 3:30 PM - 5:30 PM: Study session 2 (review & practice)
 • 5:30 PM - 6:30 PM: Extracurricular/hobbies
 • 7:00 PM - 8:00 PM: Dinner & relax
 • 8:00 PM - 9:00 PM: Light reading/review
 • 9:00 PM onwards: Wind down for bed
 
 Use the Pomodoro technique: 25 min study, 5 min break!`,
            'fitness': `🏃 FITNESS-FOCUSED SCHEDULE: 
 • 5:30 AM - 6:30 AM: Morning workout (cardio/strength)
 • 6:30 AM - 7:00 AM: Protein-rich breakfast
 • 7:00 AM - 12:00 PM: Work/study blocks
 • 12:00 PM - 1:00 PM: Healthy lunch
 • 1:00 PM - 5:00 PM: Productive work time
 • 5:00 PM - 5:30 PM: Evening walk/yoga
 • 6:00 PM - 7:00 PM: Meal prep & dinner
 • 7:00 PM - 8:00 PM: Stretching/mobility work
 • 8:00 PM - 9:00 PM: Relaxation & recovery
 • 9:00 PM: Early bedtime for optimal recovery
 
 Remember: Rest days are crucial!`,
            'creative': `🎨 CREATIVE WORK SCHEDULE: 
 • 7:00 AM - 8:00 AM: Morning pages & journaling
 • 8:00 AM - 12:00 PM: DEEP WORK BLOCK (no distractions)
 • 12:00 PM - 1:00 PM: Lunch & nature walk
 • 1:00 PM - 2:00 PM: Admin & emails
 • 2:00 PM - 5:00 PM: Creative work block 2
 • 5:00 PM - 6:00 PM: Learning/inspiration time
 • 6:00 PM onwards: Personal projects or rest
 
 Creative tip: Protect your morning hours fiercely!`
        };

        function toggleAIModal(show) {
            if (!aiModal) return;
            aiModal.classList.toggle('hidden', !show);
            if (show) aiInput.focus();
        }

        // Corrected AI button event listeners
        if (aiFab) aiFab.onclick = () => toggleAIModal(true);
        if (aiOpenBtnDesktop) aiOpenBtnDesktop.onclick = () => toggleAIModal(true);
        if (aiOpenBtnMobile) aiOpenBtnMobile.onclick = () => toggleAIModal(true);

        if (aiClose) aiClose.onclick = () => toggleAIModal(false);

        // AI suggestion buttons
        $$('.ai-suggestion-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const prompt = btn.dataset.prompt;
                toggleAIModal(true);
                setTimeout(() => {
                    aiInput.value = prompt;
                    aiForm.dispatchEvent(new Event('submit'));
                }, 100);
            });
        });

        if (aiForm) {
            aiForm.onsubmit = (e) => {
                e.preventDefault();
                const q = aiInput.value.trim();
                if (!q) return;

                const userText = `<div class="mt-4 p-2 bg-blue-50 rounded-lg"><strong>You:</strong> ${escapeHtml(q)}</div>`;
                const thinkingText = `<div class="mt-2 ai-thinking p-2 text-gray-500 italic"><em>AI:</em> Creating your personalized schedule...</div>`;
                aiResponseArea.innerHTML += userText + thinkingText;
                aiInput.value = "";
                aiResponseArea.scrollTop = aiResponseArea.scrollHeight;

                setTimeout(() => {
                    let reply;
                    const qLower = q.toLowerCase();

                    if (qLower.includes('professional') || qLower.includes('work')) {
                        reply = aiScheduleReplies.professional;
                    } else if (qLower.includes('student') || qLower.includes('study') || qLower.includes('class')) {
                        reply = aiScheduleReplies.student;
                    } else if (qLower.includes('fitness') || qLower.includes('exercise') || qLower.includes('workout')) {
                        reply = aiScheduleReplies.fitness;
                    } else if (qLower.includes('creative') || qLower.includes('deep work')) {
                        reply = aiScheduleReplies.creative;
                    } else {
                        reply = `Here are some general productivity tips: 
 1. Use time blocking to allocate specific time slots for tasks 
 2. Take regular breaks (try the 52-17 rule: 52 min work, 17 min break) 
 3. Batch similar tasks together for efficiency 
 4. Schedule your most important work during peak energy hours 
 5. Leave buffer time between activities for flexibility
 
 Ask me for a specific schedule type: professional, student, fitness, or creative!`;
                    }

                    const thinkingElement = aiResponseArea.querySelector('.ai-thinking:last-child');
                    if (thinkingElement) {
                        thinkingElement.innerHTML = `<div class="p-3 bg-red-50 rounded-lg"><strong>AI:</strong><pre class="whitespace-pre-wrap font-sans text-sm mt-2">${reply}</pre></div>`;
                        thinkingElement.classList.remove('ai-thinking', 'italic', 'text-gray-500');
                    }

                    aiResponseArea.scrollTop = aiResponseArea.scrollHeight;
                }, 1500);
            }
        }

        // Initialize
        renderSchedule();
    </script>
</body>
</html>